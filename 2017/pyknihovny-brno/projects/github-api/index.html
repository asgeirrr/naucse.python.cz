<!doctype html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>
            
                Python a jeho knihovny: Github API
            
        </title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <link rel="stylesheet" href="/static/css/nausce.css">
        <link rel="stylesheet" href="/static/css/body.css">
        <link rel="stylesheet" href="/static/css/pygments-lovelace-style.css">
        
            <link rel="stylesheet" href="/static/css/book-style.css">
        

        
        

        <style>
            
    

        </style>
    </head>
    
    <body>
        

        
            <div class="content">
                <div class="alert alert-danger" role="alert">
                    Tato stránka je momentálně v rekonstrukci.
                    Pokud se chcete podílet na vylepšování těchto stránek,
                    navštivte repozitář na
                    <a href="https://github.com/pyvec/naucse.python.cz">GitHubu</a>.
                </div>
            </div>
        

        

<div class="page">
    <div class="container">

        
            <header class="lesson-header">
                <h1>Python a jeho knihovny</h1>
                <hr>
            </header>
        

        
            <div class="row stuff">
                <section class="col-lg-12">
                    <h1>Webové API</h1>
                    <div>
                        Jak už <a href="/2017/pyknihovny-brno/intro/json/">bylo řečeno</a>, hlavní výhoda
                        formátu JSON je, že se na Internetu rozšířil nejvíc.
                        Pojďme toho využít!
                    </div>
                    <div>
                        Spousta webových služeb poskytuje takzvané
                        <em>API</em> (<em>application programming interface</em>,
                        programátorské rozhraní), přes které je možné s danou
                        službou komunikovat programově.
                        Místo klikání na tlačítek a čtení stránek „očima”
                        dostaneme data ve formátu, kterým rozumí počítače –
                        a v dnešní době to bude většinou formát JSON.
                    </div>
                    <div>
                        Z minulých srazů máme otevřený účet na github.com,
                        tak se zkusme zeptat Githubu, co o nás ví.
                    </div>
                    <h2>Autorizace</h2>
                    <div>
                        První, a mnohdy nejsložitější, krok k použití API
                        je přihlášení. Počítače se totiž přihlašují jinak
                        než lidi, a problematika bezpečnosti a oprávnění by
                        vydala na samostatný kurz.
                        My to uděláme co nejjednodušeji, ať se rychle dostaneme
                        k jádru věci:
                        <ol>
                            <li>
                                Přihlaš se na <a href="https://github.com">github.com</a>.
                            </li>
                            <li>
                                Jdi na <a href="https://github.com/settings/tokens">nastavení Personal Accesss Tokens</a>
                            </li>
                            <li>
                                Vytvoř si nový token ("Generate new token"). Nezaškrtávej žádná oprávnění navíc.
                            </li>
                            <li>
                                Zkopíruj si heslo, které takto dostaneš, do souboru <code>token.txt</code>.
                            </li>
                        </ol>
                    </div>
                    <div class="note">
                        Pozor! Vygenerovaný kód je heslo, které držitele
                        opravňuje pracovat s Githubem pod tvým jménem!
                        Drž ho v tajnosti, a kdyby se dostalo „ven”, na stránce
                        <a href="https://github.com/settings/tokens">Personal Accesss Tokens</a>
                        ho deaktivuj.
                    </div>
                    <h2>Requests</h2>
                    <div>
                        K práci s internetovými stránkami použijeme knihovnu Requests.
                        V aktivovaném virtuálním prostředí si ji nainstaluj příkazem:
                        <pre>$ python -m pip install requests</pre>
                    </div>
                    <div>
                        A potom v Pythonu zkus stáhnout nějakou stránku:
<pre>
import requests

# stažení stránky
stranka = requests.get('https://github.com')

# ověření, že dotaz proběhl v pořádku
stranka.raise_for_status()

# vypsání obsahu
print(stranka.text)
</pre>
                        Měl by se vypsat obsah stránky
                        <a href="https://github.com">https://github.com</a> –
                        HTML kód; který se objeví když v prohlížeči dáš
                        „Ukázat zdroj” (<em>View Page Source</em>, většinou Ctrl+U),
                        a ze kterého prohlížeč umí vykreslit stránku.
                    </div>
                    <div>
                        Ale my nechceme obsah pro lidi.
                        Podívejme se, co Github zpřístupňuje počítačům.
                    </div>
                    <h2>Uživatelský účet</h2>
                    <div>
                        Zkus, co dělá tento kód:
<pre>
import requests

with open('token.txt') as soubor:
    token = soubor.read().strip()

headers = {'Authorization': 'token ' + token}

stranka = requests.get('https://api.github.com/user', headers=headers)
stranka.raise_for_status()
print(stranka.text)
</pre>
                        Co se stalo? Tím, že jsi Githubu dala svůj token,
                        (načtený ze souboru, předaný přes slovník <code>headers</code>),
                        poznal že jde dotaz od tebe, a vrátil nějaké informace
                        ve formátu JSON.
                    </div>
                    <div>
                        Zkusíme řetězec <code>stranka.text</code>
                        převést z JSON na slovník, a vypsat trochu srozumitelněji:
<pre>
data = json.loads(stranka.text)

print(json.dumps(data, ensure_ascii=True, indent=2))
</pre>
                        Teď už je lépe vidět celý tvůj profil
                        (včetně neveřejných informací – proto musíš svůj token
                        udržovat v tajnosti).
                    </div>
                    <div>
                        S profilem, který máš v proměnné <code>data</code>,
                        se dá pracovat jako s každým jiným slovníkem.
                        Třeba adresu svého obrázku můžeš vypsat pomocí:
<pre>
print(data['avatar_url'])
</pre>
                    </div>
                    <h2>API Githubu</h2>
                    <div>
                        API Githubu toho umí mnohem víc. Třeba na adrese
                        <code>https://api.github.com/emojis</code> na tebe čeká
                        slovník s adresami malých obrázků.
                        (Tenhle slovník funguje jako vyhledávací tabulka.)
                        Celé API je zdokumentováno na adrese
                        <a href="https://developer.github.com/v3/">developer.github.com</a>.
                    </div>
                    <h2>Interakce</h2>
                    <p>
                        Pomocí webových API se dají informace nejen číst, ale
                        i měnit.
                    </p>
                    <p>
                        Na stránce
                        <a href="https://github.com/PyLadiesCZ/pyladies.cz/stargazers">github.com/PyLadiesCZ/pyladies.cz/stargazers</a>
                        je seznam lidí, kteří „ohvězdičkovali” stránky PyLadies CZ
                        a tyto učební ateriály.
                        Je jich zatím málo; pojďme se k nim pomocí webového API přidat.
                    </p>
                    <p>
                        Napřed svéhmu tokenu (na Githubu v nastavení
                        <a href="https://github.com/settings/tokens">Personal Accesss Tokens</a>)
                        přidej právo <code>public_repo</code>.
                        Od teď token střež obzvlášť pečlivě, protože se pomocí
                        něj dají informace na Githubu i měnit.
                    </p>
                    <p>
                        Chceme-li měnit informace, musíme knihovně Requests
                        říct, aby použila jinou „HTTP metodu” než <code>GET</code>.
                        Co to přesně jsou HTTP metody je na trochu delší povídání
                        (viz <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">Wikipedia</a>),
                        ale stručně řečeno, pomocí <code>GET</code> se většinou stahuje
                        obsah, pomocí <code>POST</code> se přidává nový,
                        <code>PUT</code> mění něco, co už na webu existuje,
                        a <code>DELETE</code> něco maže.
                        Jakou, to závisí na tom, co chceme udělat;
                        většinou to bude <code>POST</code>, <code>PUT</code>
                        nebo <code>DELETE</code>.
                    </p>
                    <p>
                        Podle <a href="https://developer.github.com/v3/activity/starring/#star-a-repository">dokumentace Githubu</a>
                        se přidání hvězdičky dělá pomocí <code>PUT</code>
                        dotazu na adresu <code>/user/starred/:owner/:repo</code>.
                        Za <code>:owner</code> a <code>:repo</code>
                        dosadíš vlastníka a jméno repozitáře
                        (v našem případě <code>pyladiescz</code> a <code>pyladies.cz</code>),
                        a <code>PUT</code> metodu zvolíš tak, že zavoláš místo
                        <code>get</code> funkci <code>put</code>:
                    </p>
<pre>
import requests

with open('token.txt') as soubor:
    token = soubor.read().strip()

headers = {'Authorization': 'token ' + token}

stranka = requests.put('https://api.github.com/user/starred/pyladiescz/pyladies.cz', headers=headers)
stranka.raise_for_status()
</pre>
                    <p>
                        Tenhle dotaz nevrátí žádný text, ale na
                        <a href="https://github.com/PyLadiesCZ/pyladies/stargazers">github.com/PyLadiesCZ/pyladies/stargazers</a>
                        se můžeš přesvědčit, že to funguje.
                    </p>
                    <p>
                        Chceš-li hvězdičku zase odstranit, použij metodu
                        <code>DELETE</code> na stejnou adresu.
                        (Ale nezapomeň tam pak ★ zase vrátit! ☺)
                    </p>
                </section>
            </div>
        

        <hr class="lesson-end">

        

        

    </div>
</div>



        <script type="text/javascript" src="/static/js/solutions.js"></script>

        
        
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

    </body>
</html>